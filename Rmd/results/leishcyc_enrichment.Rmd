### LeishCyc pathway enrichment

source: http://www.biocyc.org/LEISH/organism-summary?object=LEISH

```{r load_leishcyc, results='asis'}
# load data
leishcyc_infile <- file.path(Sys.getenv('REF'), 'lmajor_friedlin', 'annotation',
                            'LeishCyc_19.5_mapping.csv')

# load full LeishCyc mapping
leishcyc_mapping <- read.csv(leishcyc_infile)
colnames(leishcyc_mapping) <- c('category', 'gene_id')
```

```{r leishcyc_gene_enrichment, message=FALSE, warning=FALSE, results='hide', cache=CONFIG$use_cache, autodep=TRUE}
# Initialize CPUs
cl <- makeCluster(min(12, detectCores() - 1))
registerDoParallel(cl)

# Check each module for pathway enrichment and save result in a list
leishcyc_pathway_enrichment <- foreach(color=unique(module_colors), .packages=c('goseq')) %dopar% {
    # Measure enrichment for module
    enriched <- tryCatch({
        in_module_geneids <- gene_ids[module_colors == color]
        enriched <- test_gene_enrichment(in_module_geneids, gene_ids,
                                        leishcyc_mapping, gene_lengths)
    }, error=function(e) {
        # goseq fails in some cases; have not been able to track down cause yet
        # Note: goseq will also fail if supplied with a dplyr tbl_df so first 
        # make sure that is not the case
        warning(sprintf("LeishCyc enrichment failed for module %s", color))
        return(get_enrichment_placeholder())
    })
    enriched
}
names(leishcyc_pathway_enrichment) <- unique(module_colors)

# remove any null entries from the results
leishcyc_pathway_enrichment <- leishcyc_pathway_enrichment[!sapply(leishcyc_pathway_enrichment, is.null)]

# unregister cpus
stopCluster(cl)
```

```{r leishcyc_enrichment_results, results='asis'}
if (CONFIG$include_tables) {
    print_enrichment_results(leishcyc_pathway_enrichment, module_sizes, 
                             'LeishCyc Pathway', output_dir='output/modules',
                             enrichment_type='leishcyc')
}
```

